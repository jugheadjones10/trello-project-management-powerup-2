<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Page Title</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- <script type="module" src="https://unpkg.com/x-frame-bypass"></script> -->

    <script src="x-frame-bypass.js"></script>
</head>

<body>
    <iframe is="x-frame-bypass" id="fk" src="https://calendar.google.com/calendar/" width="100%"></iframe>

    <script>
        document.getElementById("fk").setAttribute("height", window.innerHeight)
    </script>



    <template id="user-card-template">
        <link rel="stylesheet" href="myWebComponent/myWebComponent.css">
        
        <div class="card__user-card-container">
            <h2 class="card__name">
                <span class="card__full-name"></span> (
                <span class="card__user-name"></span>)
            </h2>
            <p>Website: <a class="card__website"></a></p>
            <div class="card__hidden-content">
                <p class="card__address"></p>
            </div>
            <button class="card__details-btn">More Details</button>
        </div>
    </template>

    <script>
        (function () {
            // const template = document.createElement('template')
            // template.innerHTML = `
            // <template id="user-card-template">
            //     <link rel="stylesheet" href="myWebComponent/myWebComponent.css">
                
            //     <div class="card__user-card-container">
            //         <h2 class="card__name">
            //             <span class="card__full-name"></span> (
            //             <span class="card__user-name"></span>)
            //         </h2>
            //         <p>Website: <a class="card__website"></a></p>
            //         <div class="card__hidden-content">
            //             <p class="card__address"></p>
            //         </div>
            //         <button class="card__details-btn">More Details</button>
            //     </div>
            // </template>
            // `

            const currentDocument = document.currentScript.ownerDocument

            class myWebComponent extends HTMLElement {
                constructor() {
                    super()

                    this.addEventListener("click", function (e) {
                        this.toggleCard()
                    })
                }

                // Called when element is inserted in DOM
                connectedCallback() {
                    const shadowRoot = this.attachShadow({ mode: 'open' })

                    // Select the template and clone it. Finally attach the cloned node to the shadowDOM's root.
                    // Current document needs to be defined to get DOM access to imported HTML
                    const template = currentDocument.querySelector('#user-card-template')
                    const instance = template.content.cloneNode(true)
                    shadowRoot.appendChild(instance)

                    // Extract the attribute user-id from our element. 
                    // Note that we are going to specify our cards like: 
                    // <user-card user-id="1"></user-card>
                    const userId = this.getAttribute('user-id')

                    // Fetch the data for that user Id from the API and call the render method with this data
                    fetch(`https://jsonplaceholder.typicode.com/users/${userId}`)
                        .then((response) => response.text())
                        .then((responseText) => {
                            this.render(JSON.parse(responseText))
                        })
                        .catch((error) => {
                            console.error(error)
                        })
                }

                render(userData) {
                    // Fill the respective areas of the card using DOM manipulation APIs
                    // All of our components elements reside under shadow dom. So we created a this.shadowRoot property
                    // We use this property to call selectors so that the DOM is searched only under this subtree
                    this.shadowRoot.querySelector('.card__full-name').innerHTML = userData.name
                    this.shadowRoot.querySelector('.card__user-name').innerHTML = userData.username
                    this.shadowRoot.querySelector('.card__website').innerHTML = userData.website
                    this.shadowRoot.querySelector('.card__address').innerHTML = `<h4>Address</h4>
                    ${userData.address.suite}, <br />
                    ${userData.address.street},<br />
                    ${userData.address.city},<br />
                    Zipcode: ${userData.address.zipcode}`
                }

                toggleCard() {
                    let elem = this.shadowRoot.querySelector('.card__hidden-content')
                    let btn = this.shadowRoot.querySelector('.card__details-btn')
                    btn.innerHTML = elem.style.display == 'none' ? 'Less Details' : 'More Details'
                    elem.style.display = elem.style.display == 'none' ? 'block' : 'none'
                }

            }

            window.customElements.define("my-web-component", myWebComponent)
        }())
    </script>

    <img src="https://upload.wikimedia.org/wikipedia/en/thumb/a/a6/Rick_Sanchez.png/160px-Rick_Sanchez.png">

    <my-web-component user-id="2"></my-web-component>
</body>

</html>