<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Page Title</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- <script type="module" src="https://unpkg.com/x-frame-bypass"></script> -->

    <script>
        customElements.define('x-frame-bypass', class extends HTMLIFrameElement {
            constructor() {
                super()
            }
            connectedCallback() {
                this.load(this.src)
                this.src = ''
                this.sandbox = '' + this.sandbox || 'allow-forms allow-modals allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts allow-top-navigation-by-user-activation' // all except allow-top-navigation
            }
            load(url, options) {
                if (!url || !url.startsWith('http'))
                    throw new Error(`X-Frame-Bypass src ${url} does not start with http(s)://`)
                console.log('X-Frame-Bypass loading:', url)
                this.srcdoc = `<html>
<head>
	<style>
	.loader {
		position: absolute;
		top: calc(50% - 25px);
		left: calc(50% - 25px);
		width: 50px;
		height: 50px;
		background-color: #333;
		border-radius: 50%;  
		animation: loader 1s infinite ease-in-out;
	}
	@keyframes loader {
		0% {
		transform: scale(0);
		}
		100% {
		transform: scale(1);
		opacity: 0;
		}
	}
	</style>
</head>
<body>
	<div class="loader"></div>
</body>
</html>`


                this.fetchProxy(url, options, 0).then(res => res.text()).then(data => {
                    if (data)
                        this.srcdoc = data.replace(/<head([^>]*)>/i, `<head$1>
	<base href="${url}">
	<script>
	// X-Frame-Bypass navigation event handlers
	document.addEventListener('click', e => {
		if (frameElement && document.activeElement && document.activeElement.href) {
			e.preventDefault()
			frameElement.load(document.activeElement.href)
		}
	})
	document.addEventListener('submit', e => {
		if (frameElement && document.activeElement && document.activeElement.form && document.activeElement.form.action) {
			e.preventDefault()
			if (document.activeElement.form.method === 'post')
				frameElement.load(document.activeElement.form.action, {method: 'post', body: new FormData(document.activeElement.form)})
			else
				frameElement.load(document.activeElement.form.action + '?' + new URLSearchParams(new FormData(document.activeElement.form)))
		}
	})
    </script>`)
    }).catch(e => console.error('Cannot load X-Frame-Bypass:', e))
    }
    fetchProxy(url, options, i) {
    const proxy = [
    'https://cors.io/?',
    'https://jsonp.afeld.me/?url=',
    'https://cors-anywhere.herokuapp.com/'
    ]
    return fetch(proxy[i] + url, options).then(res => {
    if (!res.ok)
    throw new Error(`${res.status} ${res.statusText}`)
    return res
    }).catch(error => {
    if (i === proxy.length - 1)
    throw error
    return this.fetchProxy(url, options, i + 1)
    })
    }
    }, { extends: 'iframe' })

    </script>
</head>

<body>
    <iframe is="x-frame-bypass" id="fk" src="https://calendar.google.com/calendar/" width="100%"></iframe>

    <script>
        document.getElementById("fk").setAttribute("height", window.innerHeight)
    </script>



    <template id="user-card-template">
        <link rel="stylesheet" href="myWebComponent/myWebComponent.css">

        <div class="card__user-card-container">
            <h2 class="card__name">
                <span class="card__full-name"></span> (
                <span class="card__user-name"></span>)
            </h2>
            <p>Website: <a class="card__website"></a></p>
            <div class="card__hidden-content">
                <p class="card__address"></p>
            </div>
            <button class="card__details-btn">More Details</button>
        </div>
    </template>

    <script>
        (function () {
            // const template = document.createElement('template')
            // template.innerHTML = `
            // <template id="user-card-template">
            //     <link rel="stylesheet" href="myWebComponent/myWebComponent.css">

            //     <div class="card__user-card-container">
            //         <h2 class="card__name">
            //             <span class="card__full-name"></span> (
            //             <span class="card__user-name"></span>)
            //         </h2>
            //         <p>Website: <a class="card__website"></a></p>
            //         <div class="card__hidden-content">
            //             <p class="card__address"></p>
            //         </div>
            //         <button class="card__details-btn">More Details</button>
            //     </div>
            // </template>
            // `

            const currentDocument = document.currentScript.ownerDocument

            class myWebComponent extends HTMLElement {
                constructor() {
                    super()

                    this.addEventListener("click", function (e) {
                        this.toggleCard()
                    })
                }

                // Called when element is inserted in DOM
                connectedCallback() {
                    const shadowRoot = this.attachShadow({ mode: 'open' })

                    // Select the template and clone it. Finally attach the cloned node to the shadowDOM's root.
                    // Current document needs to be defined to get DOM access to imported HTML
                    const template = currentDocument.querySelector('#user-card-template')
                    const instance = template.content.cloneNode(true)
                    shadowRoot.appendChild(instance)

                    // Extract the attribute user-id from our element. 
                    // Note that we are going to specify our cards like: 
                    // <user-card user-id="1"></user-card>
                    const userId = this.getAttribute('user-id')

                    // Fetch the data for that user Id from the API and call the render method with this data
                    fetch(`https://jsonplaceholder.typicode.com/users/${userId}`)
                        .then((response) => response.text())
                        .then((responseText) => {
                            this.render(JSON.parse(responseText))
                        })
                        .catch((error) => {
                            console.error(error)
                        })
                }

                render(userData) {
                    // Fill the respective areas of the card using DOM manipulation APIs
                    // All of our components elements reside under shadow dom. So we created a this.shadowRoot property
                    // We use this property to call selectors so that the DOM is searched only under this subtree
                    this.shadowRoot.querySelector('.card__full-name').innerHTML = userData.name
                    this.shadowRoot.querySelector('.card__user-name').innerHTML = userData.username
                    this.shadowRoot.querySelector('.card__website').innerHTML = userData.website
                    this.shadowRoot.querySelector('.card__address').innerHTML = `<h4>Address</h4>
                    ${userData.address.suite}, <br />
                    ${userData.address.street},<br />
                    ${userData.address.city},<br />
                    Zipcode: ${userData.address.zipcode}`
                }

                toggleCard() {
                    let elem = this.shadowRoot.querySelector('.card__hidden-content')
                    let btn = this.shadowRoot.querySelector('.card__details-btn')
                    btn.innerHTML = elem.style.display == 'none' ? 'Less Details' : 'More Details'
                    elem.style.display = elem.style.display == 'none' ? 'block' : 'none'
                }

            }

            window.customElements.define("my-web-component", myWebComponent)
        }())
    </script>

    <img src="https://upload.wikimedia.org/wikipedia/en/thumb/a/a6/Rick_Sanchez.png/160px-Rick_Sanchez.png">

    <my-web-component user-id="2"></my-web-component>
</body>

</html>