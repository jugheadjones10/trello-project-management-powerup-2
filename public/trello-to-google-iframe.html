<!DOCTYPE html>
<html>

<head>

    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://trello.com/1/client.js?key=aa0f9cf4d2d738632836aa054dcdda43"></script>

</head>

<body>
    <script>
        var t = window.TrelloPowerUp.iframe()
        window.Trello.authorize({
            type: 'popup',
            name: 'Getting Started Application',
            scope: {
                read: 'true',
                write: 'true'
            },
            expiration: '1day',
            success: function () {
                console.log('Successful authentication')
            },
            error: function () {
                console.log('Failed authentication')
            }
        })

        setInterval(function () {
            console.log("fuck this shit")
            t.board('id').then(function (board) {
                console.log(board)
                Trello.get(`/boards/${board.id}/actions`, function (actions) {
                    console.log(actions)
                    for (var i = 0; i < actions.length; i++) {
                        if (actions[i].data.old.hasOwnProperty("due")) {
                            // new date is in actions[i].data.card.due
                            var event = {
                                'summary': actions[i].data.card.name,
                                'location': 'implement location later',
                                // 'description': 'implement description later',
                                'start': {
                                    'date': actions[i].data.card.due.substring(0, 10)
                                },
                                'end': {
                                    'date': actions[i].data.card.due.substring(0, 10)
                                },
                            }
                            gapi.client.calendar.events.insert({
                                'calendarId': 'primary',
                                'resource': event
                            }).then(function (response) {
                                console.log(response)
                            })

                            break
                        }
                    }
                }, function () {
                    console.log("error")
                })
            })
        }, 10000)

    </script>
</body>

</html>