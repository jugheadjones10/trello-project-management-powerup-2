<html>

<head>
  <link rel="stylesheet" href="https://p.trellocdn.com/power-up.min.css">
  <script src="https://p.trellocdn.com/power-up.min.js"></script>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

  <script src="./js/googleUrlConverter.js"></script>
  <style>
    #googleIFRAME {
      height: 320px;
      width: 512px;
    }
  </style>
</head>

<body>
  <div id="googleIFRAME"></div>

  <script>
    t.render(function () {
      t.card('attachments')
      //gets the all the attachments on a card that is currently open
      //what else can be passed into the t.card() method? Any of the properties returned when 
      //t.card("all") is called (things like id and url) can be passed in.
      //You can get a few properties at the same time too, by separating them with commas in the call
        .get('attachments')
        .filter(function (attachment) {
          return attachment.url.indexOf('https://www.google.com/maps/place/') == 0
        })
        .then(function (attachArray) {
          var latestURL = attachArray[attachArray.length - 1].url
          t.set("card", "shared", "coords", GoogleMapsURLToEmbedURL(latestURL))
          document.location.reload()
        })
    })
  </script>

  <script>
    function initMap() {
      t.get("card", "shared", "coords").then(function (coords) {
        var coordi = {
          lat: Number(coords.latitude), lng: Number(coords.longitude)
        }

        var map = new google.maps.Map(document.getElementById('googleIFRAME'), {
          center: coordi,
          zoom: 16
        })

        var marker = new google.maps.Marker({ position: coordi, map: map })
      })
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBUapN3kozFMAp4SOwmpU4e6eVqDZD_DEU&callback=initMap"></script>
</body>

</html>